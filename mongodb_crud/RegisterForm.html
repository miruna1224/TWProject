
<html>
<head>
  <link rel="stylesheet" href="css_functions.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="f1.css">
</head>
<body>
  <header class="header">
      <h1 class="title">EASY HIGH SCHOOL END</h1>
      <h2 class="subtitle"> | Signin | </h2>
  </header>
    <div>
    </div> <br> <br> <br>
    <div class="page-container">
      <form class = "form" method="get">
        <label for="todo">Form</label>
        <font style = "font-size:2.5vw;" color = "black"> FirstName : </font><br>
        <input style = "font-size:1.5vw;" type="text" name="FirstName"/><br>
        <font style = "font-size:2.5vw;"  color = "black">LastName : </font><br>
        <input style = "font-size:1.5vw;"  type="text" name="LastName"/><br>
        <font style = "font-size:2.5vw;" color = "black">Username : </font><br>
        <input style = "font-size:1.5vw;" type="text" name="Username" /><br>
        <font style = "font-size:2.5vw;"  color = "black">Password :  </font><br>
        <input style = "font-size:1.5vw;" type="password" name="Password" id = "myInput" autocomplete="off"/>

        <br>
        <font  style = "font-size:2.5vw;" color = "black">Email :  </font><br>
        <input  style = "font-size:1.5vw;" type="text" name="Email"/><br>

        <input  style="margin:15;font-family:verdana;" color = "black" type="radio"  value="male" checked> Client
        <input  style="margin:15;font-family:verdana;" color = "black" type="radio"  value="female"> Admin <br>

        <br>
        <font style="margin:85;font-family:verdana;" color = "black" > <button style = "font-size:2vw;" type="submit" value="Submit"/> Submit </button></font><br>
        <a style="margin:85;font-family:verdana;font-size:2vw;" color = "black" href="home.html"> Back</a>

        <div class="alert" role="alert" id="message"></div>

      </form>
    </div>


  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

  <script>
         $(document).ready(()=>{
             const display = $("#display");
             const form = $("#form");
             const todoUserInput = $("#todoUserInput");
             const message = $("#message");
             message.hide();

             const displayMessage = (flag,msg)=>{
                 // successful
                 if(flag){
                     message.removeClass('alert-danger');
                     message.addClass('alert-success');
                     message.html(msg);
                     message.show();
                 }
                 else{
                     message.removeClass('alert-success');
                     message.addClass('alert-danger');
                     message.html(msg);
                     message.show();
                 }
             }

             const getTodos = ()=>{
                 fetch('/getTodos',{method : "get"}).then((response)=>{
                     return response.json();
                 }).then((data)=>{
                     console.log(data);
                     displayTodos(data);
                 });
             }

             getTodos();

             const resetTodosInput = ()=>{
                 todoUserInput.val('');
             }

             const editTodo = (todo,todoID,editID)=>{
                 let editBtn = $(`#${editID}`);
                 editBtn.click(()=>{
                     fetch(`/${todo._id}`,{
                         method : "put",
                         headers : {
                             "Content-Type" : "application/json; charset=utf-8"
                         },
                         body : JSON.stringify({todo : todoUserInput.val()})
                     }).then((response)=>{
                         return response.json();
                     }).then((data)=>{
                         if(data.ok == 1){
                             let todoIndex = $(`#${todoID}`);
                             todoIndex.html(data.value.todo);
                             resetTodosInput();
                         }
                     });
                 });
             }

             const deleteTodo = (todo,listItemID,deleteID)=>{
                 let deleteBtn = $(`#${deleteID}`);
                 deleteBtn.click(()=>{
                     fetch(`/${todo._id}`,{
                         method: "delete"
                     }).then((response)=>{
                         return response.json();
                     }).then((data)=>{
                         if(data.ok == 1){
                             $(`#${listItemID}`).remove();
                         }
                     });
                 });
             }


             const buildIDS = (todo)=>{
                 return {
                     editID : "edit_" + todo._id,
                     deleteID : "delete_" + todo._id,
                     listItemID : "listItem_" + todo._id,
                     todoID : "todo_" + todo._id
                 }
             }

             const buildTemplate = (todo,ids)=>{
                 return `<li class="list-group-item" id="${ids.listItemID}">
                             <div class="row">
                                 <div class="col-md-4" id="${ids.todoID}">${todo.todo}</div>
                                 <div class="col-md-4"></div>
                                 <div class="col-md-4 text-right">
                                     <button type="button" class="btn btn-secondary" id="${ids.editID}">Edit</button>
                                     <button type="button" class="btn btn-danger" id="${ids.deleteID}">Delete</button>
                                 </div>
                             </div>
                        </li>`;
             }

             const displayTodos = (data)=>{
                 data.forEach((todo)=>{
                     let ids = buildIDS(todo);
                     display.append(buildTemplate(todo,ids));
                     editTodo(todo,ids.todoID,ids.editID);
                     deleteTodo(todo,ids.listItemID,ids.deleteID);
                 });
             }

             form.submit((e)=>{
                 e.preventDefault();
                 fetch('/',{
                     method : 'post',
                     body : JSON.stringify({todo : todoUserInput.val()}),
                     headers : {
                         "Content-Type" : "application/json; charset=utf-8"
                     }
                 }).then((response)=>{
                     return response.json();
                 }).then((data)=>{
                     if(!data.error){
                         if(data.result.ok == 1 && data.result.n == 1){
                             let ids = buildIDS(data.document);
                             display.append(buildTemplate(data.document,ids));
                             editTodo(data.document,ids.todoID,ids.editID);
                             deleteTodo(data.document,ids.listItemID,ids.deleteID);
                             displayMessage(true,data.msg);
                         }
                     }
                     else
                         displayMessage(false,data.error.message);

                     resetTodosInput();

                 });
             });

         });
     </script>
 </body>
 </html>
